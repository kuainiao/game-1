var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(a,r){function o(t){try{h(i.next(t))}catch(e){r(e)}}function s(t){try{h(i["throw"](t))}catch(e){r(e)}}function h(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,r=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){h.label=n[1];break}if(6===n[0]&&h.label<o[1]){h.label=o[1],o=n;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(n);break}o[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Tile=function(t){function e(e){var n=t.call(this)||this;return n.index=0,n._isOpen=!0,n._redSkin=new egret.Bitmap,n._redSkin.texture=e.getTexture("pot2"),n._blackSkin=new egret.Bitmap,n._blackSkin.texture=e.getTexture("pot1"),n.anchorOffsetX=50,n.anchorOffsetY=50,n.width=45,n.height=45,n.touchEnabled=!0,n.addChild(n._blackSkin),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.onClick,n),n}return __extends(e,t),e.prototype.getStatus=function(){return this._isOpen},e.prototype.open=function(){this._isOpen||(this._isOpen=!0,this.removeChild(this._redSkin),this.addChild(this._blackSkin))},e.prototype.close=function(){this._isOpen&&(this._isOpen=!1,this.removeChild(this._blackSkin),this.addChild(this._redSkin))},e.prototype.onClick=function(){if(this._isOpen){var t=new GameEvent(GameEvent.OPEN_TILE);t.open_tile_index=this.index,this.dispatchEvent(t)}this.close()},e}(egret.Sprite);__reflect(Tile.prototype,"Tile");var GameEvent=function(t){function e(e,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var a=t.call(this,e,n,i)||this;return a.open_tile_index=0,a}return __extends(e,t),e.OPEN_TILE="open_tile",e.START_GAME="start_game",e}(egret.Event);__reflect(GameEvent.prototype,"GameEvent");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return n.sent(),this.stage.removeChild(t),[3,4];case 3:return e=n.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){this._viewManage=new ViewManage(this,RES.getRes("gameres_json")),this._viewManage.addEventListener(GameEvent.START_GAME,this.startGame,this),this._viewManage.addEventListener(GameEvent.OPEN_TILE,this.openTile,this)},e.prototype.startGame=function(){DataManage.instance().init_tileDatas(),DataManage.instance().selectTile(),DataManage.instance().createCatPoint(),this._viewManage.updateAll()},e.prototype.openTile=function(t){DataManage.instance().stepNum++,DataManage.instance().closeTileByIndex(t.open_tile_index);var e=DataManage.instance().isHaveNextPointByCat();e?this._viewManage.update():this._viewManage.showGameOverView(DataManage.instance()._isS)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var CatAI=function(){function t(){}return t.prototype.findPath=function(t){for(var e,n,i=[t],a=[],r=0,o=!0;o;){if(0==i.length)return o=!1,null;for(var s=[],h=i.length,c=0;h>c;c++){e=i.shift(),n=this.findRound(e),r=n.length;for(var l=0;r>l;l++)if(this.map[n[l]]._isUsed&&a.push(n[l]),!(a.indexOf(n[l])>-1||i.indexOf(n[l])>-1)){if(this.map[n[l]].preIndex=e,this.isExit(n[l]))return n[l];s.push(n[l])}a.push(e)}i=s}},t.prototype.findNextPoint=function(t){this.initMap();var e=this.findPath(t);if(null==e)return null;if(-1==e)return-1;for(var n,i=!0;i;)n=this.map[e].preIndex,n!=t&&-1!=n?e=n:i=!1;return e},t.prototype.isExit=function(t){var e=Util.getPointByIndex(t),n=e.y,i=e.x;return 0==n||8==n||0==i||8==i?!0:!1},t.prototype.getNear=function(t){var e=this.findRound(t);return e[0]},t.prototype.initMap=function(){if(null==this.map){this.map=[];for(var t=0;t<DataManage.tileNum;t++)this.map.push(new CatNode)}for(var t=0;t<DataManage.tileNum;t++)this.map[t].clean(),DataManage.instance().getStatusByIndex(t)||(this.map[t]._isUsed=!0)},t.prototype.findRound=function(t){var e=[],n=Util.getPointByIndex(t),i=n.y,a=n.x,r=a-1,o=Util.GetIndexByPoint(new egret.Point(r,i));r>=0&&!this.map[o]._isUsed&&e.push(o);var s=a+1,h=Util.GetIndexByPoint(new egret.Point(s,i));8>=s&&!this.map[h]._isUsed&&e.push(h);var c=i-1,l=Util.GetIndexByPoint(new egret.Point(a,c));c>=0&&!this.map[l]._isUsed&&e.push(l);var u=i+1,_=Util.GetIndexByPoint(new egret.Point(a,u));if(8>=u&&!this.map[_]._isUsed&&e.push(_),i%2==0){var d=Util.GetIndexByPoint(new egret.Point(r,c));r>=0&&c>=0&&!this.map[d]._isUsed&&e.push(d);var p=Util.GetIndexByPoint(new egret.Point(r,u));r>=0&&8>=u&&!this.map[p]._isUsed&&e.push(p)}else{var f=Util.GetIndexByPoint(new egret.Point(s,c));8>=s&&c>=0&&!this.map[f]._isUsed&&e.push(f);var g=Util.GetIndexByPoint(new egret.Point(s,u));8>=s&&8>=u&&!this.map[g]._isUsed&&e.push(g)}return e=e.sort()},t}();__reflect(CatAI.prototype,"CatAI");var CatNode=function(){function t(){this.preIndex=-1,this._isUsed=!1}return t.prototype.clean=function(){this.preIndex=-1,this._isUsed=!1},t}();__reflect(CatNode.prototype,"CatNode");var DataManage=function(){function t(){if(this.stepNum=0,this.catDefaultIndex=40,this._isS=!1,this._tileDatas=[],this._catIndex=this.catDefaultIndex,!t._isInit)throw new Error("error!");this._catAI=new CatAI,this.createData()}return t.instance=function(){return t._isInit||(t._isInit=!0,this._dataManage=new t),t._dataManage},t.prototype.createData=function(){for(var e=0;e<t.tileNum;e++)this._tileDatas[e]=!0},t.prototype.init_tileDatas=function(){t.catIsAction1mc=!0;for(var e=0;e<t.tileNum;e++)this._tileDatas[e]=!0},t.prototype.selectTile=function(){for(var e=10+Math.floor(10*Math.random()),n=0;e>n;n++){var i=Math.floor(Math.random()*t.tileNum);this._tileDatas[i]=!1}this._tileDatas[this.catDefaultIndex]=!0},t.prototype.closeTileByIndex=function(t){this._tileDatas[t]=!1},t.prototype.getStatusByIndex=function(t){return this._tileDatas[t]},t.prototype.createCatPoint=function(){this._catIndex=this.catDefaultIndex},t.prototype.getCatIndex=function(){return this._catIndex},t.prototype.isHaveNextPointByCat=function(){if(this._catAI.isExit(this._catIndex))return this._isS=!1,!1;var e=this._catAI.findNextPoint(this._catIndex);return null==e?(t.catIsAction1mc=!1,this._catIndex=this._catAI.getNear(this._catIndex),this._catIndex?!0:(this._isS=!0,!1)):-1==e?(this._isS=!0,!1):(this._catIndex=e,!0)},t._isInit=!1,t.catIsAction1mc=!0,t.tileNum=81,t}();__reflect(DataManage.prototype,"DataManage");var Cat=function(t){function e(){var e=t.call(this)||this;e._isAction1mc=!0;var n=RES.getRes("stay_mc_json"),i=RES.getRes("stay_tex_png"),a=new egret.MovieClipDataFactory(n,i);return e._action1mc=new egret.MovieClip(a.generateMovieClipData("stay")),e._action1mc.gotoAndPlay(1,-1),n=RES.getRes("weizhu_mc_json"),i=RES.getRes("weizhu_tex_png"),a=new egret.MovieClipDataFactory(n,i),e._action2mc=new egret.MovieClip(a.generateMovieClipData("weizhu")),e._action2mc.gotoAndPlay(1,-1),e.anchorOffsetX=30,e.anchorOffsetY=55,e.playAction(),e}return __extends(e,t),e.prototype.init=function(){this._isAction1mc=!0,this.playAction()},e.prototype.playAction=function(){this.numChildren&&this.removeChildAt(0),this._isAction1mc?this.addChild(this._action1mc):this.addChild(this._action2mc)},Object.defineProperty(e.prototype,"isAction1",{get:function(){return this._isAction1mc},set:function(t){this._isAction1mc!=t&&(this._isAction1mc=t,this.playAction())},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(Cat.prototype,"Cat");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var BackGroundPanel=function(t){function e(e,n){var i=t.call(this)||this;return i.texture=n.getTexture("bg"),e.addChild(i),i}return __extends(e,t),e}(egret.Bitmap);__reflect(BackGroundPanel.prototype,"BackGroundPanel");var GameOverButtonPanel=function(t){function e(e){var n=t.call(this)||this;n._reStartBtn=new egret.Sprite,n._reStartBtn.width=200,n._reStartBtn.height=103;var i=new egret.Bitmap;return i.texture=e.getTexture("replay"),n._reStartBtn.addChild(i),n._reStartBtn.touchEnabled=!0,n.addChild(n._reStartBtn),n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2,n}return __extends(e,t),e}(egret.Sprite);__reflect(GameOverButtonPanel.prototype,"GameOverButtonPanel");var GameOverPanelF=function(t){function e(e){var n=t.call(this)||this,i=new egret.Bitmap;return i.texture=e.getTexture("failed"),n.addChild(i),n.width=448,n.height=361,n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2,n}return __extends(e,t),e}(egret.Sprite);__reflect(GameOverPanelF.prototype,"GameOverPanelF");var GameOverPanelS=function(t){function e(e){var n=t.call(this)||this,i=new egret.Bitmap;return i.texture=e.getTexture("victory"),n.addChild(i),n.width=448,n.height=338,n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2,n}return __extends(e,t),e}(egret.Sprite);__reflect(GameOverPanelS.prototype,"GameOverPanelS");var StartGamePanel=function(t){function e(e){var n=t.call(this)||this,i=new egret.Bitmap;return i.texture=e.getTexture("btn_start"),n.width=400,n.height=588,n.touchEnabled=!0,n.x=(egret.MainContext.instance.stage.stageWidth-n.width)/2,n.y=(egret.MainContext.instance.stage.stageHeight-n.height)/2,n.addChild(i),n}return __extends(e,t),e}(egret.Sprite);__reflect(StartGamePanel.prototype,"StartGamePanel");var Util=function(){function t(){}return t.getPointByIndex=function(t){var e=new egret.Point;return e.x=t%9,e.y=Math.floor(t/9),e},t.getPointXYByIndex=function(t){var e=new egret.Point,n=0;return Math.floor(t/9)%2==1&&(n=25),e.x=120+45*(t%9)+n,e.y=400+45*Math.floor(t/9),e},t.GetIndexByPoint=function(t){return 9*t.y+t.x},t}();__reflect(Util.prototype,"Util");var ViewManage=function(t){function e(e,n){var i=t.call(this)||this;return i._tiles=[],i._rootView=e,i._textures=n,i._backGroundPanel=new BackGroundPanel(e,n),i._StartGamePanel=new StartGamePanel(n),i._StartGamePanel.addEventListener(egret.TouchEvent.TOUCH_TAP,i.OnStartGameClick,i),i._GameOverPanelS=new GameOverPanelS(n),i._GameOverPanelF=new GameOverPanelF(n),i._GameOverButtonPanel=new GameOverButtonPanel(n),i._GameOverButtonPanel._reStartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,i.OnReStartClick,i),i.showStartGameView(),i}return __extends(e,t),e.prototype.createCat=function(){this._cat=new Cat},e.prototype.showStartGameView=function(){this._StartGamePanel&&this._rootView.addChild(this._StartGamePanel)},e.prototype.OnStartGameClick=function(){this._rootView.removeChild(this._StartGamePanel),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnStartGameClick,this),this.createTiles(),this.createCat();var t=new GameEvent(GameEvent.START_GAME);this.dispatchEvent(t)},e.prototype.OnReStartClick=function(){this._GameOverPanelS.parent?this._rootView.removeChild(this._GameOverPanelS):this._rootView.removeChild(this._GameOverPanelF),this._rootView.removeChild(this._GameOverButtonPanel);var t=new GameEvent(GameEvent.START_GAME);this.dispatchEvent(t)},e.prototype.createTiles=function(){for(var t=0;t<DataManage.tileNum;t++){var e=new Tile(this._textures);e.index=t,this._tiles.push(e),e.addEventListener(GameEvent.OPEN_TILE,this.OnOpenTile,this)}this.showTiles()},e.prototype.OnOpenTile=function(t){this.dispatchEvent(t)},e.prototype.showTiles=function(){for(var t=0;t<DataManage.tileNum;t++){var e=Util.getPointXYByIndex(this._tiles[t].index);this._tiles[t].x=e.x,this._tiles[t].y=e.y,this._rootView.addChild(this._tiles[t])}},e.prototype.updateAll=function(){for(var t=DataManage.tileNum,e=0;t>e;e++)DataManage.instance().getStatusByIndex(e)?this._tiles[e].open():this._tiles[e].close();null==this._cat.parent&&this._rootView.addChild(this._cat),this._cat.init(),this.update()},e.prototype.update=function(){var t=DataManage.instance().getCatIndex(),e=Util.getPointXYByIndex(t);this._cat.x=e.x,this._cat.y=e.y,this._cat.isAction1=DataManage.catIsAction1mc},e.prototype.showGameOverView=function(t){t?this._rootView.addChild(this._GameOverPanelS):this._rootView.addChild(this._GameOverPanelF),this._rootView.addChild(this._GameOverButtonPanel)},e}(egret.EventDispatcher);__reflect(ViewManage.prototype,"ViewManage"),window.Main=Main;